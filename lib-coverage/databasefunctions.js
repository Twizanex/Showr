/* automatically generated by JSCoverage - do not edit */
try {
  if (typeof top === 'object' && top !== null && typeof top.opener === 'object' && top.opener !== null) {
    // this is a browser window that was opened from another window

    if (! top.opener._$jscoverage) {
      top.opener._$jscoverage = {};
    }
  }
}
catch (e) {}

try {
  if (typeof top === 'object' && top !== null) {
    // this is a browser window

    try {
      if (typeof top.opener === 'object' && top.opener !== null && top.opener._$jscoverage) {
        top._$jscoverage = top.opener._$jscoverage;
      }
    }
    catch (e) {}

    if (! top._$jscoverage) {
      top._$jscoverage = {};
    }
  }
}
catch (e) {}

try {
  if (typeof top === 'object' && top !== null && top._$jscoverage) {
    _$jscoverage = top._$jscoverage;
  }
}
catch (e) {}
if (typeof _$jscoverage !== 'object') {
  _$jscoverage = {};
}
if (! _$jscoverage['databasefunctions.js']) {
  _$jscoverage['databasefunctions.js'] = [];
  _$jscoverage['databasefunctions.js'][4] = 0;
  _$jscoverage['databasefunctions.js'][5] = 0;
  _$jscoverage['databasefunctions.js'][7] = 0;
  _$jscoverage['databasefunctions.js'][8] = 0;
  _$jscoverage['databasefunctions.js'][9] = 0;
  _$jscoverage['databasefunctions.js'][11] = 0;
  _$jscoverage['databasefunctions.js'][12] = 0;
  _$jscoverage['databasefunctions.js'][13] = 0;
  _$jscoverage['databasefunctions.js'][17] = 0;
  _$jscoverage['databasefunctions.js'][18] = 0;
  _$jscoverage['databasefunctions.js'][19] = 0;
  _$jscoverage['databasefunctions.js'][20] = 0;
  _$jscoverage['databasefunctions.js'][28] = 0;
  _$jscoverage['databasefunctions.js'][35] = 0;
  _$jscoverage['databasefunctions.js'][36] = 0;
  _$jscoverage['databasefunctions.js'][37] = 0;
  _$jscoverage['databasefunctions.js'][38] = 0;
  _$jscoverage['databasefunctions.js'][46] = 0;
  _$jscoverage['databasefunctions.js'][47] = 0;
  _$jscoverage['databasefunctions.js'][48] = 0;
  _$jscoverage['databasefunctions.js'][49] = 0;
  _$jscoverage['databasefunctions.js'][50] = 0;
  _$jscoverage['databasefunctions.js'][51] = 0;
  _$jscoverage['databasefunctions.js'][52] = 0;
  _$jscoverage['databasefunctions.js'][53] = 0;
  _$jscoverage['databasefunctions.js'][55] = 0;
  _$jscoverage['databasefunctions.js'][61] = 0;
  _$jscoverage['databasefunctions.js'][62] = 0;
  _$jscoverage['databasefunctions.js'][63] = 0;
}
_$jscoverage['databasefunctions.js'].source = ["<span class=\"c\">/**</span>","<span class=\"c\"> * Created by eli on 2014-10-07.</span>","<span class=\"c\"> */</span>","<span class=\"k\">var</span> mongoose <span class=\"k\">=</span> require<span class=\"k\">(</span><span class=\"s\">'mongoose'</span><span class=\"k\">);</span>","<span class=\"k\">var</span> User <span class=\"k\">=</span> mongoose<span class=\"k\">.</span>model<span class=\"k\">(</span><span class=\"s\">'User'</span><span class=\"k\">);</span>","","<span class=\"k\">function</span> restricted<span class=\"k\">(</span>req<span class=\"k\">,</span>res<span class=\"k\">,</span> next<span class=\"k\">)</span> <span class=\"k\">{</span>","    <span class=\"k\">if</span> <span class=\"k\">(</span>req<span class=\"k\">.</span>session<span class=\"k\">.</span>user_id<span class=\"k\">)</span> <span class=\"k\">{</span>","        next<span class=\"k\">();</span>","    <span class=\"k\">}</span> <span class=\"k\">else</span> <span class=\"k\">{</span>","        res<span class=\"k\">.</span>writeHead<span class=\"k\">(</span><span class=\"s\">403</span><span class=\"k\">);</span>","        res<span class=\"k\">.</span>write<span class=\"k\">(</span><span class=\"s\">\"You must be logged in to view this page\"</span><span class=\"k\">);</span>","        res<span class=\"k\">.</span>end<span class=\"k\">();</span>","    <span class=\"k\">}</span>","<span class=\"k\">}</span>","","<span class=\"k\">function</span> registerUser<span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span> <span class=\"k\">{</span>","    User<span class=\"k\">.</span>findOne<span class=\"k\">(</span><span class=\"k\">{</span>username<span class=\"k\">:</span> req<span class=\"k\">.</span>body<span class=\"k\">.</span>username<span class=\"k\">}</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span><span class=\"k\">{</span>","        <span class=\"k\">if</span><span class=\"k\">(</span>user<span class=\"k\">)</span><span class=\"k\">{</span>","            res<span class=\"k\">.</span>render<span class=\"k\">(</span><span class=\"s\">'signup-in'</span><span class=\"k\">,</span> <span class=\"k\">{</span>","                actionpath<span class=\"k\">:</span><span class=\"s\">\"/signup\"</span><span class=\"k\">,</span>","                headingtext<span class=\"k\">:</span><span class=\"s\">\"Fill in wanted username and password to sign up\"</span><span class=\"k\">,</span>","                buttontext<span class=\"k\">:</span><span class=\"s\">\"Sign up, its free\"</span><span class=\"k\">,</span>","                user_id<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user_id<span class=\"k\">,</span>","                msg<span class=\"k\">:</span> <span class=\"s\">\"That username is already in use\"</span>","            <span class=\"k\">}</span><span class=\"k\">);</span>","        <span class=\"k\">}</span><span class=\"k\">else</span> <span class=\"k\">{</span>","            <span class=\"k\">new</span> User<span class=\"k\">(</span><span class=\"k\">{</span>","                username<span class=\"k\">:</span> req<span class=\"k\">.</span>body<span class=\"k\">.</span>username<span class=\"k\">,</span>","                password<span class=\"k\">:</span> req<span class=\"k\">.</span>body<span class=\"k\">.</span>password<span class=\"k\">,</span>","                friends<span class=\"k\">:</span> <span class=\"k\">[],</span>","                wall_posts<span class=\"k\">:</span> <span class=\"k\">[],</span>","                photo_album<span class=\"k\">:</span> <span class=\"k\">[]</span>","            <span class=\"k\">}</span><span class=\"k\">).</span>save<span class=\"k\">(</span><span class=\"k\">function</span> <span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span> <span class=\"k\">{</span>","                    <span class=\"k\">if</span> <span class=\"k\">(!</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","                        req<span class=\"k\">.</span>session<span class=\"k\">.</span>user <span class=\"k\">=</span> user<span class=\"k\">;</span>","                        req<span class=\"k\">.</span>session<span class=\"k\">.</span>user_id <span class=\"k\">=</span> <span class=\"k\">true</span><span class=\"k\">;</span>","                        res<span class=\"k\">.</span>redirect<span class=\"k\">(</span><span class=\"s\">\"/profile\"</span><span class=\"k\">);</span>","                    <span class=\"k\">}</span>","                <span class=\"k\">}</span><span class=\"k\">)</span>","        <span class=\"k\">}</span>","    <span class=\"k\">}</span><span class=\"k\">)</span>","<span class=\"k\">}</span>","","","<span class=\"k\">function</span> queryUser<span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span><span class=\"k\">{</span>","    <span class=\"k\">var</span> query <span class=\"k\">=</span> User<span class=\"k\">.</span>where<span class=\"k\">(</span><span class=\"k\">{</span>username<span class=\"k\">:</span> req<span class=\"k\">.</span>body<span class=\"k\">.</span>username<span class=\"k\">}</span><span class=\"k\">);</span>","    query<span class=\"k\">.</span>findOne<span class=\"k\">(</span><span class=\"k\">function</span><span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span><span class=\"k\">{</span>","        <span class=\"k\">if</span><span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">throw</span><span class=\"k\">(</span>err<span class=\"k\">);</span>","        <span class=\"k\">if</span><span class=\"k\">(</span>user<span class=\"k\">)</span><span class=\"k\">{</span>","            req<span class=\"k\">.</span>session<span class=\"k\">.</span>user <span class=\"k\">=</span> user<span class=\"k\">;</span>","            req<span class=\"k\">.</span>session<span class=\"k\">.</span>user_id <span class=\"k\">=</span> <span class=\"k\">true</span><span class=\"k\">;</span>","            res<span class=\"k\">.</span>redirect<span class=\"k\">(</span><span class=\"s\">\"/profile\"</span><span class=\"k\">);</span>","        <span class=\"k\">}</span><span class=\"k\">else</span><span class=\"k\">{</span>","            res<span class=\"k\">.</span>render<span class=\"k\">(</span><span class=\"s\">'signup-in'</span><span class=\"k\">,</span> <span class=\"k\">{</span>actionpath<span class=\"k\">:</span><span class=\"s\">\"/signin\"</span><span class=\"k\">,</span> msg<span class=\"k\">:</span> <span class=\"s\">\"no user with that username and password\"</span><span class=\"k\">,</span>","                headingtext<span class=\"k\">:</span><span class=\"s\">\"Input username and password to sign in\"</span><span class=\"k\">,</span> buttontext<span class=\"k\">:</span><span class=\"s\">\"Sign in\"</span><span class=\"k\">}</span><span class=\"k\">)</span>","        <span class=\"k\">}</span>","    <span class=\"k\">}</span><span class=\"k\">)</span>","<span class=\"k\">}</span>","","exports<span class=\"k\">.</span>registerUser <span class=\"k\">=</span> registerUser<span class=\"k\">;</span>","exports<span class=\"k\">.</span>queryUser <span class=\"k\">=</span> queryUser<span class=\"k\">;</span>","exports<span class=\"k\">.</span>restricted <span class=\"k\">=</span> restricted<span class=\"k\">;</span>"];
_$jscoverage['databasefunctions.js'][4]++;
var mongoose = require("mongoose");
_$jscoverage['databasefunctions.js'][5]++;
var User = mongoose.model("User");
_$jscoverage['databasefunctions.js'][7]++;
function restricted(req, res, next) {
  _$jscoverage['databasefunctions.js'][8]++;
  if (req.session.user_id) {
    _$jscoverage['databasefunctions.js'][9]++;
    next();
  }
  else {
    _$jscoverage['databasefunctions.js'][11]++;
    res.writeHead(403);
    _$jscoverage['databasefunctions.js'][12]++;
    res.write("You must be logged in to view this page");
    _$jscoverage['databasefunctions.js'][13]++;
    res.end();
  }
}
_$jscoverage['databasefunctions.js'][17]++;
function registerUser(req, res) {
  _$jscoverage['databasefunctions.js'][18]++;
  User.findOne({username: req.body.username}, (function (err, user) {
  _$jscoverage['databasefunctions.js'][19]++;
  if (user) {
    _$jscoverage['databasefunctions.js'][20]++;
    res.render("signup-in", {actionpath: "/signup", headingtext: "Fill in wanted username and password to sign up", buttontext: "Sign up, its free", user_id: req.session.user_id, msg: "That username is already in use"});
  }
  else {
    _$jscoverage['databasefunctions.js'][28]++;
    new User({username: req.body.username, password: req.body.password, friends: [], wall_posts: [], photo_album: []}).save((function (err, user) {
  _$jscoverage['databasefunctions.js'][35]++;
  if ((! err)) {
    _$jscoverage['databasefunctions.js'][36]++;
    req.session.user = user;
    _$jscoverage['databasefunctions.js'][37]++;
    req.session.user_id = true;
    _$jscoverage['databasefunctions.js'][38]++;
    res.redirect("/profile");
  }
}));
  }
}));
}
_$jscoverage['databasefunctions.js'][46]++;
function queryUser(req, res) {
  _$jscoverage['databasefunctions.js'][47]++;
  var query = User.where({username: req.body.username});
  _$jscoverage['databasefunctions.js'][48]++;
  query.findOne((function (err, user) {
  _$jscoverage['databasefunctions.js'][49]++;
  if (err) {
    _$jscoverage['databasefunctions.js'][49]++;
    throw err;
  }
  _$jscoverage['databasefunctions.js'][50]++;
  if (user) {
    _$jscoverage['databasefunctions.js'][51]++;
    req.session.user = user;
    _$jscoverage['databasefunctions.js'][52]++;
    req.session.user_id = true;
    _$jscoverage['databasefunctions.js'][53]++;
    res.redirect("/profile");
  }
  else {
    _$jscoverage['databasefunctions.js'][55]++;
    res.render("signup-in", {actionpath: "/signin", msg: "no user with that username and password", headingtext: "Input username and password to sign in", buttontext: "Sign in"});
  }
}));
}
_$jscoverage['databasefunctions.js'][61]++;
exports.registerUser = registerUser;
_$jscoverage['databasefunctions.js'][62]++;
exports.queryUser = queryUser;
_$jscoverage['databasefunctions.js'][63]++;
exports.restricted = restricted;
