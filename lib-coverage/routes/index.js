/* automatically generated by JSCoverage - do not edit */
try {
  if (typeof top === 'object' && top !== null && typeof top.opener === 'object' && top.opener !== null) {
    // this is a browser window that was opened from another window

    if (! top.opener._$jscoverage) {
      top.opener._$jscoverage = {};
    }
  }
}
catch (e) {}

try {
  if (typeof top === 'object' && top !== null) {
    // this is a browser window

    try {
      if (typeof top.opener === 'object' && top.opener !== null && top.opener._$jscoverage) {
        top._$jscoverage = top.opener._$jscoverage;
      }
    }
    catch (e) {}

    if (! top._$jscoverage) {
      top._$jscoverage = {};
    }
  }
}
catch (e) {}

try {
  if (typeof top === 'object' && top !== null && top._$jscoverage) {
    _$jscoverage = top._$jscoverage;
  }
}
catch (e) {}
if (typeof _$jscoverage !== 'object') {
  _$jscoverage = {};
}
if (! _$jscoverage['routes/index.js']) {
  _$jscoverage['routes/index.js'] = [];
  _$jscoverage['routes/index.js'][1] = 0;
  _$jscoverage['routes/index.js'][2] = 0;
  _$jscoverage['routes/index.js'][3] = 0;
  _$jscoverage['routes/index.js'][4] = 0;
  _$jscoverage['routes/index.js'][5] = 0;
  _$jscoverage['routes/index.js'][6] = 0;
  _$jscoverage['routes/index.js'][7] = 0;
  _$jscoverage['routes/index.js'][8] = 0;
  _$jscoverage['routes/index.js'][9] = 0;
  _$jscoverage['routes/index.js'][11] = 0;
  _$jscoverage['routes/index.js'][12] = 0;
  _$jscoverage['routes/index.js'][13] = 0;
  _$jscoverage['routes/index.js'][15] = 0;
  _$jscoverage['routes/index.js'][18] = 0;
  _$jscoverage['routes/index.js'][19] = 0;
  _$jscoverage['routes/index.js'][22] = 0;
  _$jscoverage['routes/index.js'][23] = 0;
  _$jscoverage['routes/index.js'][32] = 0;
  _$jscoverage['routes/index.js'][33] = 0;
  _$jscoverage['routes/index.js'][36] = 0;
  _$jscoverage['routes/index.js'][37] = 0;
  _$jscoverage['routes/index.js'][40] = 0;
  _$jscoverage['routes/index.js'][41] = 0;
  _$jscoverage['routes/index.js'][44] = 0;
  _$jscoverage['routes/index.js'][45] = 0;
  _$jscoverage['routes/index.js'][46] = 0;
  _$jscoverage['routes/index.js'][50] = 0;
  _$jscoverage['routes/index.js'][51] = 0;
  _$jscoverage['routes/index.js'][52] = 0;
  _$jscoverage['routes/index.js'][53] = 0;
  _$jscoverage['routes/index.js'][54] = 0;
  _$jscoverage['routes/index.js'][56] = 0;
  _$jscoverage['routes/index.js'][60] = 0;
  _$jscoverage['routes/index.js'][62] = 0;
  _$jscoverage['routes/index.js'][64] = 0;
  _$jscoverage['routes/index.js'][66] = 0;
  _$jscoverage['routes/index.js'][68] = 0;
  _$jscoverage['routes/index.js'][69] = 0;
  _$jscoverage['routes/index.js'][70] = 0;
  _$jscoverage['routes/index.js'][72] = 0;
  _$jscoverage['routes/index.js'][78] = 0;
  _$jscoverage['routes/index.js'][79] = 0;
  _$jscoverage['routes/index.js'][81] = 0;
  _$jscoverage['routes/index.js'][94] = 0;
  _$jscoverage['routes/index.js'][95] = 0;
  _$jscoverage['routes/index.js'][96] = 0;
  _$jscoverage['routes/index.js'][104] = 0;
  _$jscoverage['routes/index.js'][105] = 0;
  _$jscoverage['routes/index.js'][107] = 0;
  _$jscoverage['routes/index.js'][108] = 0;
  _$jscoverage['routes/index.js'][109] = 0;
  _$jscoverage['routes/index.js'][110] = 0;
  _$jscoverage['routes/index.js'][113] = 0;
  _$jscoverage['routes/index.js'][118] = 0;
  _$jscoverage['routes/index.js'][120] = 0;
  _$jscoverage['routes/index.js'][121] = 0;
  _$jscoverage['routes/index.js'][123] = 0;
  _$jscoverage['routes/index.js'][124] = 0;
  _$jscoverage['routes/index.js'][127] = 0;
  _$jscoverage['routes/index.js'][128] = 0;
  _$jscoverage['routes/index.js'][129] = 0;
  _$jscoverage['routes/index.js'][131] = 0;
  _$jscoverage['routes/index.js'][132] = 0;
  _$jscoverage['routes/index.js'][139] = 0;
  _$jscoverage['routes/index.js'][140] = 0;
  _$jscoverage['routes/index.js'][146] = 0;
  _$jscoverage['routes/index.js'][147] = 0;
  _$jscoverage['routes/index.js'][149] = 0;
  _$jscoverage['routes/index.js'][154] = 0;
  _$jscoverage['routes/index.js'][155] = 0;
  _$jscoverage['routes/index.js'][156] = 0;
  _$jscoverage['routes/index.js'][157] = 0;
  _$jscoverage['routes/index.js'][163] = 0;
  _$jscoverage['routes/index.js'][164] = 0;
  _$jscoverage['routes/index.js'][169] = 0;
  _$jscoverage['routes/index.js'][170] = 0;
  _$jscoverage['routes/index.js'][171] = 0;
  _$jscoverage['routes/index.js'][172] = 0;
  _$jscoverage['routes/index.js'][179] = 0;
  _$jscoverage['routes/index.js'][180] = 0;
  _$jscoverage['routes/index.js'][182] = 0;
  _$jscoverage['routes/index.js'][185] = 0;
  _$jscoverage['routes/index.js'][191] = 0;
  _$jscoverage['routes/index.js'][192] = 0;
  _$jscoverage['routes/index.js'][194] = 0;
  _$jscoverage['routes/index.js'][199] = 0;
  _$jscoverage['routes/index.js'][200] = 0;
  _$jscoverage['routes/index.js'][201] = 0;
  _$jscoverage['routes/index.js'][202] = 0;
  _$jscoverage['routes/index.js'][208] = 0;
  _$jscoverage['routes/index.js'][209] = 0;
  _$jscoverage['routes/index.js'][214] = 0;
  _$jscoverage['routes/index.js'][215] = 0;
  _$jscoverage['routes/index.js'][216] = 0;
  _$jscoverage['routes/index.js'][217] = 0;
  _$jscoverage['routes/index.js'][218] = 0;
  _$jscoverage['routes/index.js'][219] = 0;
  _$jscoverage['routes/index.js'][220] = 0;
  _$jscoverage['routes/index.js'][221] = 0;
  _$jscoverage['routes/index.js'][223] = 0;
  _$jscoverage['routes/index.js'][224] = 0;
  _$jscoverage['routes/index.js'][229] = 0;
  _$jscoverage['routes/index.js'][230] = 0;
  _$jscoverage['routes/index.js'][231] = 0;
  _$jscoverage['routes/index.js'][232] = 0;
  _$jscoverage['routes/index.js'][236] = 0;
  _$jscoverage['routes/index.js'][237] = 0;
  _$jscoverage['routes/index.js'][238] = 0;
  _$jscoverage['routes/index.js'][239] = 0;
  _$jscoverage['routes/index.js'][240] = 0;
  _$jscoverage['routes/index.js'][244] = 0;
}
_$jscoverage['routes/index.js'].source = ["<span class=\"k\">var</span> mongoose <span class=\"k\">=</span> require<span class=\"k\">(</span><span class=\"s\">'mongoose'</span><span class=\"k\">);</span>","<span class=\"k\">var</span> User <span class=\"k\">=</span> mongoose<span class=\"k\">.</span>model<span class=\"k\">(</span><span class=\"s\">'User'</span><span class=\"k\">);</span>","<span class=\"k\">var</span> express <span class=\"k\">=</span> require<span class=\"k\">(</span><span class=\"s\">'express'</span><span class=\"k\">);</span>","<span class=\"k\">var</span> formidable <span class=\"k\">=</span> require<span class=\"k\">(</span><span class=\"s\">'formidable'</span><span class=\"k\">);</span>","<span class=\"k\">var</span> fs <span class=\"k\">=</span> require<span class=\"k\">(</span><span class=\"s\">'fs-extra'</span><span class=\"k\">);</span>","<span class=\"k\">var</span> qt <span class=\"k\">=</span> require<span class=\"k\">(</span><span class=\"s\">'quickthumb'</span><span class=\"k\">);</span>","<span class=\"k\">var</span> util <span class=\"k\">=</span> require<span class=\"k\">(</span><span class=\"s\">'util'</span><span class=\"k\">);</span>","<span class=\"k\">var</span> router <span class=\"k\">=</span> express<span class=\"k\">.</span>Router<span class=\"k\">();</span>","<span class=\"k\">var</span> dbfunctions <span class=\"k\">=</span> require<span class=\"k\">(</span><span class=\"s\">\"../databasefunctions\"</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>get<span class=\"k\">(</span><span class=\"s\">'/'</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span> <span class=\"k\">{</span>","    <span class=\"k\">if</span> <span class=\"k\">(</span>req<span class=\"k\">.</span>session<span class=\"k\">.</span>user_id<span class=\"k\">)</span> <span class=\"k\">{</span>","\tres<span class=\"k\">.</span>redirect<span class=\"k\">(</span><span class=\"s\">'/profile'</span><span class=\"k\">);</span>","    <span class=\"k\">}</span>","    res<span class=\"k\">.</span>render<span class=\"k\">(</span><span class=\"s\">'index'</span><span class=\"k\">,</span> <span class=\"k\">{</span>user_id<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user_id<span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>get<span class=\"k\">(</span><span class=\"s\">'/contact'</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span> <span class=\"k\">{</span>","    res<span class=\"k\">.</span>render<span class=\"k\">(</span><span class=\"s\">'contact'</span><span class=\"k\">,</span> <span class=\"k\">{</span>user_id<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user_id<span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>get<span class=\"k\">(</span><span class=\"s\">'/signup'</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span> <span class=\"k\">{</span>","    res<span class=\"k\">.</span>render<span class=\"k\">(</span><span class=\"s\">'signup-in'</span><span class=\"k\">,</span> <span class=\"k\">{</span>","\tactionpath<span class=\"k\">:</span><span class=\"s\">\"/signup\"</span><span class=\"k\">,</span>","\theadingtext<span class=\"k\">:</span><span class=\"s\">\"Fill in wanted username and password to sign up\"</span><span class=\"k\">,</span>","\tbuttontext<span class=\"k\">:</span><span class=\"s\">\"Sign up, its free\"</span><span class=\"k\">,</span>","\tuser_id<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user_id<span class=\"k\">,</span>","    msg<span class=\"k\">:</span> <span class=\"s\">\"\"</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>post<span class=\"k\">(</span><span class=\"s\">'/signup'</span><span class=\"k\">,</span><span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span> <span class=\"k\">{</span>","    dbfunctions<span class=\"k\">.</span>registerUser<span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>get<span class=\"k\">(</span><span class=\"s\">'/signin'</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span> <span class=\"k\">{</span>","    res<span class=\"k\">.</span>render<span class=\"k\">(</span><span class=\"s\">'signup-in'</span><span class=\"k\">,</span> <span class=\"k\">{</span>actionpath<span class=\"k\">:</span><span class=\"s\">\"/signin\"</span><span class=\"k\">,</span> msg<span class=\"k\">:</span> <span class=\"s\">\"\"</span><span class=\"k\">,</span> headingtext<span class=\"k\">:</span><span class=\"s\">\"Input username and password to sign in\"</span><span class=\"k\">,</span> buttontext<span class=\"k\">:</span><span class=\"s\">\"Sign in\"</span><span class=\"k\">}</span><span class=\"k\">)</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>post<span class=\"k\">(</span><span class=\"s\">'/signin'</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span>res<span class=\"k\">)</span> <span class=\"k\">{</span>","    dbfunctions<span class=\"k\">.</span>queryUser<span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>get<span class=\"k\">(</span><span class=\"s\">'/signout'</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span><span class=\"k\">{</span>","    req<span class=\"k\">.</span>session<span class=\"k\">.</span>destroy<span class=\"k\">(</span><span class=\"k\">function</span><span class=\"k\">()</span><span class=\"k\">{</span>","        res<span class=\"k\">.</span>redirect<span class=\"k\">(</span><span class=\"s\">'/'</span><span class=\"k\">);</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>post<span class=\"k\">(</span><span class=\"s\">'/upload'</span><span class=\"k\">,</span> dbfunctions<span class=\"k\">.</span>restricted<span class=\"k\">,</span> <span class=\"k\">function</span> <span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span> <span class=\"k\">{</span>","    <span class=\"k\">var</span> form <span class=\"k\">=</span> <span class=\"k\">new</span> formidable<span class=\"k\">.</span>IncomingForm<span class=\"k\">();</span>","    form<span class=\"k\">.</span>parse<span class=\"k\">(</span>req<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>err<span class=\"k\">,</span> fields<span class=\"k\">,</span> files<span class=\"k\">)</span> <span class=\"k\">{</span>","        <span class=\"k\">if</span> <span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","            res<span class=\"k\">.</span>send<span class=\"k\">(</span>JSON<span class=\"k\">.</span>stringify<span class=\"k\">(</span><span class=\"k\">{</span>success<span class=\"k\">:</span> <span class=\"k\">false</span><span class=\"k\">}</span><span class=\"k\">));</span>","        <span class=\"k\">}</span> <span class=\"k\">else</span> <span class=\"k\">{</span>","            res<span class=\"k\">.</span>send<span class=\"k\">(</span>JSON<span class=\"k\">.</span>stringify<span class=\"k\">(</span><span class=\"k\">{</span>success<span class=\"k\">:</span> <span class=\"k\">true</span><span class=\"k\">}</span><span class=\"k\">));</span>","        <span class=\"k\">}</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","    ","    form<span class=\"k\">.</span>on<span class=\"k\">(</span><span class=\"s\">'end'</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>fields<span class=\"k\">,</span> files<span class=\"k\">)</span> <span class=\"k\">{</span>","        <span class=\"c\">/*temp location for img */</span>","        <span class=\"k\">var</span> temp_path <span class=\"k\">=</span> <span class=\"k\">this</span><span class=\"k\">.</span>openedFiles<span class=\"k\">[</span><span class=\"s\">0</span><span class=\"k\">].</span>path<span class=\"k\">;</span>","        <span class=\"c\">/* file name */</span>","        <span class=\"k\">var</span> file_name <span class=\"k\">=</span> <span class=\"k\">this</span><span class=\"k\">.</span>openedFiles<span class=\"k\">[</span><span class=\"s\">0</span><span class=\"k\">].</span>name<span class=\"k\">;</span>","        <span class=\"c\">/* location were we copy upload file */</span>","        <span class=\"k\">var</span> new_location <span class=\"k\">=</span> <span class=\"s\">'uploads/'</span><span class=\"k\">;</span>","\t","        fs<span class=\"k\">.</span>copy<span class=\"k\">(</span>temp_path<span class=\"k\">,</span> new_location <span class=\"k\">+</span> file_name<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","            <span class=\"k\">if</span><span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","                <span class=\"k\">throw</span> err<span class=\"k\">;</span>","            <span class=\"k\">}</span> <span class=\"k\">else</span> <span class=\"k\">{</span>","                addPhoto<span class=\"k\">(</span>req<span class=\"k\">,</span> file_name<span class=\"k\">);</span>","            <span class=\"k\">}</span>","        <span class=\"k\">}</span><span class=\"k\">);</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>get<span class=\"k\">(</span><span class=\"s\">'/profile'</span><span class=\"k\">,</span> dbfunctions<span class=\"k\">.</span>restricted<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span><span class=\"k\">{</span>","    User<span class=\"k\">.</span>findOne<span class=\"k\">(</span><span class=\"k\">{</span>username<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">}</span><span class=\"k\">,</span>","\t\t <span class=\"k\">function</span><span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span><span class=\"k\">{</span>","\t\t     res<span class=\"k\">.</span>render<span class=\"k\">(</span><span class=\"s\">'profile'</span><span class=\"k\">,</span>","\t\t\t\t<span class=\"k\">{</span>","\t\t\t\t    username<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">,</span>","\t\t\t\t    user_id<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user_id<span class=\"k\">,</span>","\t\t\t\t    postingas<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">,</span>","\t\t\t\t    showfriends<span class=\"k\">:</span> <span class=\"k\">true</span><span class=\"k\">,</span>","                    photo_album<span class=\"k\">:</span> user<span class=\"k\">.</span>photo_album<span class=\"k\">,</span>","\t\t\t\t    friends<span class=\"k\">:</span> user<span class=\"k\">.</span>friends<span class=\"k\">,</span>","                    show_messages<span class=\"k\">:</span> <span class=\"k\">true</span>","\t\t\t\t<span class=\"k\">}</span><span class=\"k\">);</span>","\t\t <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>get<span class=\"k\">(</span><span class=\"s\">'/profile/photos'</span><span class=\"k\">,</span> dbfunctions<span class=\"k\">.</span>restricted<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span>res<span class=\"k\">)</span> <span class=\"k\">{</span>","    User<span class=\"k\">.</span>findOne<span class=\"k\">(</span><span class=\"k\">{</span>username<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">}</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span> <span class=\"k\">{</span>","        res<span class=\"k\">.</span>render<span class=\"k\">(</span><span class=\"s\">'photos'</span><span class=\"k\">,</span>","            <span class=\"k\">{</span>","                user_id<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user_id<span class=\"k\">,</span>","                photo_album<span class=\"k\">:</span> user<span class=\"k\">.</span>photo_album","            <span class=\"k\">}</span><span class=\"k\">);</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>post<span class=\"k\">(</span><span class=\"s\">'/usersearch'</span><span class=\"k\">,</span> dbfunctions<span class=\"k\">.</span>restricted<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span><span class=\"k\">{</span>","    User<span class=\"k\">.</span>findOne<span class=\"k\">(</span><span class=\"k\">{</span>username<span class=\"k\">:</span>req<span class=\"k\">.</span>body<span class=\"k\">.</span>user<span class=\"k\">}</span><span class=\"k\">,</span>","\t\t <span class=\"k\">function</span><span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span> <span class=\"k\">{</span>","\t\t     <span class=\"k\">if</span> <span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","\t\t\t <span class=\"k\">return</span> err<span class=\"k\">;</span>","\t\t     <span class=\"k\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"k\">(</span>user<span class=\"k\">)</span> <span class=\"k\">{</span>","                res<span class=\"k\">.</span>send<span class=\"k\">(</span>JSON<span class=\"k\">.</span>stringify<span class=\"k\">(</span><span class=\"k\">{</span>success<span class=\"k\">:</span> <span class=\"k\">true</span><span class=\"k\">}</span><span class=\"k\">));</span>","\t\t     <span class=\"k\">}</span>","\t\t     <span class=\"k\">else</span> <span class=\"k\">{</span>","                res<span class=\"k\">.</span>send<span class=\"k\">(</span>JSON<span class=\"k\">.</span>stringify<span class=\"k\">(</span><span class=\"k\">{</span>success<span class=\"k\">:</span> <span class=\"k\">false</span><span class=\"k\">}</span><span class=\"k\">));</span>","\t\t     <span class=\"k\">}</span>","\t\t <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>post<span class=\"k\">(</span><span class=\"s\">'/checkfriendstatus'</span><span class=\"k\">,</span> dbfunctions<span class=\"k\">.</span>restricted<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span><span class=\"k\">{</span>","    <span class=\"c\">// As long as we are not requesting our own profile, lets check the user for friend status</span>","    <span class=\"k\">if</span> <span class=\"k\">(</span>req<span class=\"k\">.</span>body<span class=\"k\">.</span>name <span class=\"k\">&amp;&amp;</span> req<span class=\"k\">.</span>body<span class=\"k\">.</span>name <span class=\"k\">!=</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">)</span> <span class=\"k\">{</span>","        User<span class=\"k\">.</span>findOne<span class=\"k\">(</span><span class=\"k\">{</span>username<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">}</span><span class=\"k\">,</span>","\t\t     <span class=\"k\">function</span> <span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span> <span class=\"k\">{</span>","\t\t\t <span class=\"k\">if</span> <span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","\t\t\t     <span class=\"k\">throw</span> err<span class=\"k\">;</span>","\t\t\t <span class=\"k\">}</span>","\t\t\t <span class=\"k\">else</span> <span class=\"k\">{</span>","\t\t\t     <span class=\"k\">if</span> <span class=\"k\">(</span>user<span class=\"k\">.</span>friends<span class=\"k\">.</span>indexOf<span class=\"k\">(</span>req<span class=\"k\">.</span>body<span class=\"k\">.</span>name<span class=\"k\">)</span> <span class=\"k\">&gt;</span> <span class=\"k\">-</span><span class=\"s\">1</span><span class=\"k\">)</span> <span class=\"k\">{</span>","                     <span class=\"k\">var</span> result <span class=\"k\">=</span> <span class=\"k\">{</span>name<span class=\"k\">:</span>req<span class=\"k\">.</span>body<span class=\"k\">.</span>name<span class=\"k\">,</span> status<span class=\"k\">:</span><span class=\"k\">true</span><span class=\"k\">}</span><span class=\"k\">;</span>","                     res<span class=\"k\">.</span>send<span class=\"k\">(</span>JSON<span class=\"k\">.</span>stringify<span class=\"k\">(</span>result<span class=\"k\">));</span>","\t\t\t     <span class=\"k\">}</span> <span class=\"k\">else</span> <span class=\"k\">{</span>","                     <span class=\"k\">var</span> result <span class=\"k\">=</span> <span class=\"k\">{</span>name<span class=\"k\">:</span>req<span class=\"k\">.</span>body<span class=\"k\">.</span>name<span class=\"k\">,</span> status<span class=\"k\">:</span><span class=\"k\">false</span><span class=\"k\">}</span><span class=\"k\">;</span>","                     res<span class=\"k\">.</span>send<span class=\"k\">(</span>JSON<span class=\"k\">.</span>stringify<span class=\"k\">(</span>result<span class=\"k\">));</span>","\t\t\t     <span class=\"k\">}</span>","             <span class=\"k\">}</span>","             <span class=\"k\">}</span><span class=\"k\">);</span>","    <span class=\"k\">}</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","<span class=\"k\">function</span> addPhoto<span class=\"k\">(</span>req<span class=\"k\">,</span> file_name<span class=\"k\">)</span> <span class=\"k\">{</span>","    User<span class=\"k\">.</span>findOneAndUpdate<span class=\"k\">(</span>","        <span class=\"k\">{</span>","            username<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">,</span>","            password<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>password<span class=\"k\">}</span><span class=\"k\">,</span>","        <span class=\"k\">{</span><span class=\"s\">\"$push\"</span><span class=\"k\">:</span> <span class=\"k\">{</span>photo_album<span class=\"k\">:</span> file_name<span class=\"k\">}}</span><span class=\"k\">,</span>","        <span class=\"k\">function</span> <span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span> <span class=\"k\">{</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","                console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"Error adding a photo to the user\"</span><span class=\"k\">);</span>","            <span class=\"k\">}</span> <span class=\"k\">else</span> <span class=\"k\">{</span>","                console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"Added picture: \"</span> <span class=\"k\">+</span> file_name <span class=\"k\">+</span> <span class=\"s\">\" to the user\"</span><span class=\"k\">);</span>","            <span class=\"k\">}</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span>","","router<span class=\"k\">.</span>post<span class=\"k\">(</span><span class=\"s\">'/addfriend'</span><span class=\"k\">,</span> dbfunctions<span class=\"k\">.</span>restricted<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span> <span class=\"k\">{</span>","    <span class=\"k\">var</span> name <span class=\"k\">=</span> req<span class=\"k\">.</span>body<span class=\"k\">.</span>name<span class=\"k\">;</span>","    console<span class=\"k\">.</span>log<span class=\"k\">(</span>req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username <span class=\"k\">+</span> <span class=\"s\">\" adding \"</span> <span class=\"k\">+</span> name<span class=\"k\">);</span>","    User<span class=\"k\">.</span>findOneAndUpdate<span class=\"k\">(</span>","        <span class=\"k\">{</span>","            username<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">,</span>","            password<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>password<span class=\"k\">}</span><span class=\"k\">,</span>","        <span class=\"k\">{</span><span class=\"s\">\"$push\"</span><span class=\"k\">:</span> <span class=\"k\">{</span> friends<span class=\"k\">:</span> name<span class=\"k\">}}</span><span class=\"k\">,</span>","        <span class=\"k\">function</span> <span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span> <span class=\"k\">{</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","\t\tconsole<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"error adding friend to your friends list\"</span><span class=\"k\">);</span>","            <span class=\"k\">}</span>","\t<span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>post<span class=\"k\">(</span><span class=\"s\">'/removefriend'</span><span class=\"k\">,</span> dbfunctions<span class=\"k\">.</span>restricted<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span> <span class=\"k\">{</span>","    <span class=\"k\">var</span> name <span class=\"k\">=</span> req<span class=\"k\">.</span>body<span class=\"k\">.</span>name<span class=\"k\">;</span>","    console<span class=\"k\">.</span>log<span class=\"k\">(</span>req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username <span class=\"k\">+</span> <span class=\"s\">\" removing\"</span> <span class=\"k\">+</span> name<span class=\"k\">);</span>","    User<span class=\"k\">.</span>findOneAndUpdate<span class=\"k\">(</span>","        <span class=\"k\">{</span>","\t        username<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">,</span>","            password<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>password","\t<span class=\"k\">}</span><span class=\"k\">,</span>","        <span class=\"k\">{</span><span class=\"s\">\"$pull\"</span><span class=\"k\">:</span> <span class=\"k\">{</span> friends<span class=\"k\">:</span> name<span class=\"k\">}}</span><span class=\"k\">,</span>","        <span class=\"k\">function</span> <span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span> <span class=\"k\">{</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","                console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"error removing friend to your friends list\"</span><span class=\"k\">);</span>","            <span class=\"k\">}</span> <span class=\"k\">else</span><span class=\"k\">{</span>","                console<span class=\"k\">.</span>log<span class=\"k\">(</span> user<span class=\"k\">.</span>username <span class=\"k\">+</span> <span class=\"s\">\"removed\"</span> <span class=\"k\">+</span> name <span class=\"k\">+</span> <span class=\"s\">\"as friend\"</span><span class=\"k\">);</span>","            <span class=\"k\">}</span>","        <span class=\"k\">}</span><span class=\"k\">);</span>","    User<span class=\"k\">.</span>findOneAndUpdate<span class=\"k\">(</span>","        <span class=\"k\">{</span>","        username<span class=\"k\">:</span> name","        <span class=\"k\">}</span><span class=\"k\">,</span>","        <span class=\"k\">{</span><span class=\"s\">\"$pull\"</span><span class=\"k\">:</span> <span class=\"k\">{</span>friends<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">}}</span><span class=\"k\">,</span>","        <span class=\"k\">function</span> <span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span> <span class=\"k\">{</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","                console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"error removing self from friends list\"</span><span class=\"k\">);</span>","            <span class=\"k\">}</span> <span class=\"k\">else</span> <span class=\"k\">{</span>","                console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"Session user removed \"</span> <span class=\"k\">+</span> user<span class=\"k\">.</span>username <span class=\"k\">+</span> <span class=\"s\">\"from friends list as well\"</span><span class=\"k\">);</span>","            <span class=\"k\">}</span>","        <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>post<span class=\"k\">(</span><span class=\"s\">'/postmessage'</span><span class=\"k\">,</span> dbfunctions<span class=\"k\">.</span>restricted<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span><span class=\"k\">{</span>","    <span class=\"k\">var</span> name <span class=\"k\">=</span> req<span class=\"k\">.</span>body<span class=\"k\">.</span>name<span class=\"k\">;</span>","    <span class=\"k\">var</span> text <span class=\"k\">=</span> req<span class=\"k\">.</span>body<span class=\"k\">.</span>text<span class=\"k\">;</span>","    User<span class=\"k\">.</span>findOneAndUpdate<span class=\"k\">(</span>","        <span class=\"k\">{</span>","            username<span class=\"k\">:</span> name","\t    <span class=\"k\">}</span><span class=\"k\">,</span>","        <span class=\"k\">{</span><span class=\"s\">\"$push\"</span><span class=\"k\">:</span> <span class=\"k\">{</span> wall_posts<span class=\"k\">:</span> <span class=\"k\">{</span>from<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">,</span> text<span class=\"k\">:</span> text<span class=\"k\">}}}</span><span class=\"k\">,</span>","        <span class=\"k\">function</span> <span class=\"k\">(</span>err<span class=\"k\">,</span> result<span class=\"k\">)</span><span class=\"k\">{</span>","            <span class=\"k\">if</span> <span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">{</span>","                console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"error writing to wall\"</span><span class=\"k\">);</span>","            <span class=\"k\">}</span>","        <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>post<span class=\"k\">(</span><span class=\"s\">'/getall'</span><span class=\"k\">,</span> dbfunctions<span class=\"k\">.</span>restricted<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span><span class=\"k\">{</span>","    <span class=\"k\">var</span> name <span class=\"k\">=</span> req<span class=\"k\">.</span>body<span class=\"k\">.</span>name<span class=\"k\">;</span>","    User<span class=\"k\">.</span>findOne<span class=\"k\">(</span><span class=\"k\">{</span>username<span class=\"k\">:</span> name<span class=\"k\">}</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span><span class=\"k\">{</span>","\t<span class=\"k\">if</span><span class=\"k\">(</span>err<span class=\"k\">)</span><span class=\"k\">{</span>","            console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"error getting messages\"</span><span class=\"k\">);</span>","\t<span class=\"k\">}</span><span class=\"k\">else</span> <span class=\"k\">if</span><span class=\"k\">(!</span>user<span class=\"k\">)</span><span class=\"k\">{</span>","            console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"The error name:\"</span> <span class=\"k\">+</span> name<span class=\"k\">);</span>","            console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"user error\"</span><span class=\"k\">);</span>","        <span class=\"k\">}</span><span class=\"k\">else</span><span class=\"k\">{</span>","            console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"getting all from user \"</span> <span class=\"k\">+</span> user<span class=\"k\">.</span>username<span class=\"k\">);</span>","            res<span class=\"k\">.</span>send<span class=\"k\">(</span>JSON<span class=\"k\">.</span>stringify<span class=\"k\">(</span>user<span class=\"k\">.</span>wall_posts<span class=\"k\">));</span>","\t<span class=\"k\">}</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>get<span class=\"k\">(</span><span class=\"s\">'/getfriends'</span><span class=\"k\">,</span> dbfunctions<span class=\"k\">.</span>restricted<span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span>res<span class=\"k\">)</span> <span class=\"k\">{</span>","    User<span class=\"k\">.</span>findOne<span class=\"k\">(</span><span class=\"k\">{</span>username<span class=\"k\">:</span> req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">}</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span> <span class=\"k\">{</span>","        <span class=\"k\">if</span><span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">throw</span> err<span class=\"k\">;</span>","        res<span class=\"k\">.</span>send<span class=\"k\">(</span>JSON<span class=\"k\">.</span>stringify<span class=\"k\">(</span>user<span class=\"k\">.</span>friends<span class=\"k\">));</span>","    <span class=\"k\">}</span><span class=\"k\">);</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","router<span class=\"k\">.</span>get<span class=\"k\">(</span><span class=\"s\">'/getusername'</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>req<span class=\"k\">,</span> res<span class=\"k\">)</span><span class=\"k\">{</span>","    console<span class=\"k\">.</span>log<span class=\"k\">(</span><span class=\"s\">\"getting username: \"</span><span class=\"k\">+</span>req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">);</span>","    User<span class=\"k\">.</span>findOne<span class=\"k\">(</span><span class=\"k\">{</span>username<span class=\"k\">:</span>req<span class=\"k\">.</span>session<span class=\"k\">.</span>user<span class=\"k\">.</span>username<span class=\"k\">}</span><span class=\"k\">,</span> <span class=\"k\">function</span><span class=\"k\">(</span>err<span class=\"k\">,</span> user<span class=\"k\">)</span><span class=\"k\">{</span>","        <span class=\"k\">if</span><span class=\"k\">(</span>err<span class=\"k\">)</span> <span class=\"k\">throw</span> err<span class=\"k\">;</span>","        <span class=\"k\">if</span><span class=\"k\">(</span>user<span class=\"k\">)</span> res<span class=\"k\">.</span>send<span class=\"k\">(</span>JSON<span class=\"k\">.</span>stringify<span class=\"k\">(</span><span class=\"k\">{</span>username<span class=\"k\">:</span>user<span class=\"k\">.</span>username<span class=\"k\">}</span><span class=\"k\">));</span>","    <span class=\"k\">}</span><span class=\"k\">)</span>","<span class=\"k\">}</span><span class=\"k\">);</span>","","module<span class=\"k\">.</span>exports <span class=\"k\">=</span> router<span class=\"k\">;</span>"];
_$jscoverage['routes/index.js'][1]++;
var mongoose = require("mongoose");
_$jscoverage['routes/index.js'][2]++;
var User = mongoose.model("User");
_$jscoverage['routes/index.js'][3]++;
var express = require("express");
_$jscoverage['routes/index.js'][4]++;
var formidable = require("formidable");
_$jscoverage['routes/index.js'][5]++;
var fs = require("fs-extra");
_$jscoverage['routes/index.js'][6]++;
var qt = require("quickthumb");
_$jscoverage['routes/index.js'][7]++;
var util = require("util");
_$jscoverage['routes/index.js'][8]++;
var router = express.Router();
_$jscoverage['routes/index.js'][9]++;
var dbfunctions = require("../databasefunctions");
_$jscoverage['routes/index.js'][11]++;
router.get("/", (function (req, res) {
  _$jscoverage['routes/index.js'][12]++;
  if (req.session.user_id) {
    _$jscoverage['routes/index.js'][13]++;
    res.redirect("/profile");
  }
  _$jscoverage['routes/index.js'][15]++;
  res.render("index", {user_id: req.session.user_id});
}));
_$jscoverage['routes/index.js'][18]++;
router.get("/contact", (function (req, res) {
  _$jscoverage['routes/index.js'][19]++;
  res.render("contact", {user_id: req.session.user_id});
}));
_$jscoverage['routes/index.js'][22]++;
router.get("/signup", (function (req, res) {
  _$jscoverage['routes/index.js'][23]++;
  res.render("signup-in", {actionpath: "/signup", headingtext: "Fill in wanted username and password to sign up", buttontext: "Sign up, its free", user_id: req.session.user_id, msg: ""});
}));
_$jscoverage['routes/index.js'][32]++;
router.post("/signup", (function (req, res) {
  _$jscoverage['routes/index.js'][33]++;
  dbfunctions.registerUser(req, res);
}));
_$jscoverage['routes/index.js'][36]++;
router.get("/signin", (function (req, res) {
  _$jscoverage['routes/index.js'][37]++;
  res.render("signup-in", {actionpath: "/signin", msg: "", headingtext: "Input username and password to sign in", buttontext: "Sign in"});
}));
_$jscoverage['routes/index.js'][40]++;
router.post("/signin", (function (req, res) {
  _$jscoverage['routes/index.js'][41]++;
  dbfunctions.queryUser(req, res);
}));
_$jscoverage['routes/index.js'][44]++;
router.get("/signout", (function (req, res) {
  _$jscoverage['routes/index.js'][45]++;
  req.session.destroy((function () {
  _$jscoverage['routes/index.js'][46]++;
  res.redirect("/");
}));
}));
_$jscoverage['routes/index.js'][50]++;
router.post("/upload", dbfunctions.restricted, (function (req, res) {
  _$jscoverage['routes/index.js'][51]++;
  var form = new (formidable.IncomingForm)();
  _$jscoverage['routes/index.js'][52]++;
  form.parse(req, (function (err, fields, files) {
  _$jscoverage['routes/index.js'][53]++;
  if (err) {
    _$jscoverage['routes/index.js'][54]++;
    res.send(JSON.stringify({success: false}));
  }
  else {
    _$jscoverage['routes/index.js'][56]++;
    res.send(JSON.stringify({success: true}));
  }
}));
  _$jscoverage['routes/index.js'][60]++;
  form.on("end", (function (fields, files) {
  _$jscoverage['routes/index.js'][62]++;
  var temp_path = this.openedFiles[0].path;
  _$jscoverage['routes/index.js'][64]++;
  var file_name = this.openedFiles[0].name;
  _$jscoverage['routes/index.js'][66]++;
  var new_location = "uploads/";
  _$jscoverage['routes/index.js'][68]++;
  fs.copy(temp_path, (new_location + file_name), (function (err) {
  _$jscoverage['routes/index.js'][69]++;
  if (err) {
    _$jscoverage['routes/index.js'][70]++;
    throw err;
  }
  else {
    _$jscoverage['routes/index.js'][72]++;
    addPhoto(req, file_name);
  }
}));
}));
}));
_$jscoverage['routes/index.js'][78]++;
router.get("/profile", dbfunctions.restricted, (function (req, res) {
  _$jscoverage['routes/index.js'][79]++;
  User.findOne({username: req.session.user.username}, (function (err, user) {
  _$jscoverage['routes/index.js'][81]++;
  res.render("profile", {username: req.session.user.username, user_id: req.session.user_id, postingas: req.session.user.username, showfriends: true, photo_album: user.photo_album, friends: user.friends, show_messages: true});
}));
}));
_$jscoverage['routes/index.js'][94]++;
router.get("/profile/photos", dbfunctions.restricted, (function (req, res) {
  _$jscoverage['routes/index.js'][95]++;
  User.findOne({username: req.session.user.username}, (function (err, user) {
  _$jscoverage['routes/index.js'][96]++;
  res.render("photos", {user_id: req.session.user_id, photo_album: user.photo_album});
}));
}));
_$jscoverage['routes/index.js'][104]++;
router.post("/usersearch", dbfunctions.restricted, (function (req, res) {
  _$jscoverage['routes/index.js'][105]++;
  User.findOne({username: req.body.user}, (function (err, user) {
  _$jscoverage['routes/index.js'][107]++;
  if (err) {
    _$jscoverage['routes/index.js'][108]++;
    return err;
  }
  else {
    _$jscoverage['routes/index.js'][109]++;
    if (user) {
      _$jscoverage['routes/index.js'][110]++;
      res.send(JSON.stringify({success: true}));
    }
    else {
      _$jscoverage['routes/index.js'][113]++;
      res.send(JSON.stringify({success: false}));
    }
  }
}));
}));
_$jscoverage['routes/index.js'][118]++;
router.post("/checkfriendstatus", dbfunctions.restricted, (function (req, res) {
  _$jscoverage['routes/index.js'][120]++;
  if ((req.body.name && (req.body.name != req.session.user.username))) {
    _$jscoverage['routes/index.js'][121]++;
    User.findOne({username: req.session.user.username}, (function (err, user) {
  _$jscoverage['routes/index.js'][123]++;
  if (err) {
    _$jscoverage['routes/index.js'][124]++;
    throw err;
  }
  else {
    _$jscoverage['routes/index.js'][127]++;
    if ((user.friends.indexOf(req.body.name) > -1)) {
      _$jscoverage['routes/index.js'][128]++;
      var result = {name: req.body.name, status: true};
      _$jscoverage['routes/index.js'][129]++;
      res.send(JSON.stringify(result));
    }
    else {
      _$jscoverage['routes/index.js'][131]++;
      var result = {name: req.body.name, status: false};
      _$jscoverage['routes/index.js'][132]++;
      res.send(JSON.stringify(result));
    }
  }
}));
  }
}));
_$jscoverage['routes/index.js'][139]++;
function addPhoto(req, file_name) {
  _$jscoverage['routes/index.js'][140]++;
  User.findOneAndUpdate({username: req.session.user.username, password: req.session.user.password}, {"$push": {photo_album: file_name}}, (function (err, user) {
  _$jscoverage['routes/index.js'][146]++;
  if (err) {
    _$jscoverage['routes/index.js'][147]++;
    console.log("Error adding a photo to the user");
  }
  else {
    _$jscoverage['routes/index.js'][149]++;
    console.log(("Added picture: " + file_name + " to the user"));
  }
}));
}
_$jscoverage['routes/index.js'][154]++;
router.post("/addfriend", dbfunctions.restricted, (function (req, res) {
  _$jscoverage['routes/index.js'][155]++;
  var name = req.body.name;
  _$jscoverage['routes/index.js'][156]++;
  console.log((req.session.user.username + " adding " + name));
  _$jscoverage['routes/index.js'][157]++;
  User.findOneAndUpdate({username: req.session.user.username, password: req.session.user.password}, {"$push": {friends: name}}, (function (err, user) {
  _$jscoverage['routes/index.js'][163]++;
  if (err) {
    _$jscoverage['routes/index.js'][164]++;
    console.log("error adding friend to your friends list");
  }
}));
}));
_$jscoverage['routes/index.js'][169]++;
router.post("/removefriend", dbfunctions.restricted, (function (req, res) {
  _$jscoverage['routes/index.js'][170]++;
  var name = req.body.name;
  _$jscoverage['routes/index.js'][171]++;
  console.log((req.session.user.username + " removing" + name));
  _$jscoverage['routes/index.js'][172]++;
  User.findOneAndUpdate({username: req.session.user.username, password: req.session.user.password}, {"$pull": {friends: name}}, (function (err, user) {
  _$jscoverage['routes/index.js'][179]++;
  if (err) {
    _$jscoverage['routes/index.js'][180]++;
    console.log("error removing friend to your friends list");
  }
  else {
    _$jscoverage['routes/index.js'][182]++;
    console.log((user.username + "removed" + name + "as friend"));
  }
}));
  _$jscoverage['routes/index.js'][185]++;
  User.findOneAndUpdate({username: name}, {"$pull": {friends: req.session.user.username}}, (function (err, user) {
  _$jscoverage['routes/index.js'][191]++;
  if (err) {
    _$jscoverage['routes/index.js'][192]++;
    console.log("error removing self from friends list");
  }
  else {
    _$jscoverage['routes/index.js'][194]++;
    console.log(("Session user removed " + user.username + "from friends list as well"));
  }
}));
}));
_$jscoverage['routes/index.js'][199]++;
router.post("/postmessage", dbfunctions.restricted, (function (req, res) {
  _$jscoverage['routes/index.js'][200]++;
  var name = req.body.name;
  _$jscoverage['routes/index.js'][201]++;
  var text = req.body.text;
  _$jscoverage['routes/index.js'][202]++;
  User.findOneAndUpdate({username: name}, {"$push": {wall_posts: {from: req.session.user.username, text: text}}}, (function (err, result) {
  _$jscoverage['routes/index.js'][208]++;
  if (err) {
    _$jscoverage['routes/index.js'][209]++;
    console.log("error writing to wall");
  }
}));
}));
_$jscoverage['routes/index.js'][214]++;
router.post("/getall", dbfunctions.restricted, (function (req, res) {
  _$jscoverage['routes/index.js'][215]++;
  var name = req.body.name;
  _$jscoverage['routes/index.js'][216]++;
  User.findOne({username: name}, (function (err, user) {
  _$jscoverage['routes/index.js'][217]++;
  if (err) {
    _$jscoverage['routes/index.js'][218]++;
    console.log("error getting messages");
  }
  else {
    _$jscoverage['routes/index.js'][219]++;
    if ((! user)) {
      _$jscoverage['routes/index.js'][220]++;
      console.log(("The error name:" + name));
      _$jscoverage['routes/index.js'][221]++;
      console.log("user error");
    }
    else {
      _$jscoverage['routes/index.js'][223]++;
      console.log(("getting all from user " + user.username));
      _$jscoverage['routes/index.js'][224]++;
      res.send(JSON.stringify(user.wall_posts));
    }
  }
}));
}));
_$jscoverage['routes/index.js'][229]++;
router.get("/getfriends", dbfunctions.restricted, (function (req, res) {
  _$jscoverage['routes/index.js'][230]++;
  User.findOne({username: req.session.user.username}, (function (err, user) {
  _$jscoverage['routes/index.js'][231]++;
  if (err) {
    _$jscoverage['routes/index.js'][231]++;
    throw err;
  }
  _$jscoverage['routes/index.js'][232]++;
  res.send(JSON.stringify(user.friends));
}));
}));
_$jscoverage['routes/index.js'][236]++;
router.get("/getusername", (function (req, res) {
  _$jscoverage['routes/index.js'][237]++;
  console.log(("getting username: " + req.session.user.username));
  _$jscoverage['routes/index.js'][238]++;
  User.findOne({username: req.session.user.username}, (function (err, user) {
  _$jscoverage['routes/index.js'][239]++;
  if (err) {
    _$jscoverage['routes/index.js'][239]++;
    throw err;
  }
  _$jscoverage['routes/index.js'][240]++;
  if (user) {
    _$jscoverage['routes/index.js'][240]++;
    res.send(JSON.stringify({username: user.username}));
  }
}));
}));
_$jscoverage['routes/index.js'][244]++;
module.exports = router;
